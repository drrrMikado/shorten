"use strict";document.addEventListener("DOMContentLoaded",()=>{const{copyBtnElem:e,submitBtnElem:t,formElem:n,urlInputElem:o,errElem:r}={copyBtnElem:document.getElementById("shortenCopyButton"),submitBtnElem:document.getElementById("shortenSubmitButton"),formElem:document.getElementById("shortenForm"),urlInputElem:document.getElementById("shortenURLInput"),errElem:document.getElementById("errorMsg")},i=e=>{r.innerHTML=e,r.style.display="block",setTimeout(()=>{r.style.display="none",r.innerHTML=""},1e3)},s=n=>{n.preventDefault(),e.style.display="none",t.style.display="block",o.removeEventListener("change",s),o.removeEventListener("input",s)};n.addEventListener("submit",n=>{n.preventDefault();let r=o.value;/http:\/\/|https:\/\//.test(r)||(r="http://"+r);let l="";try{l=new URL(r)}catch(n){return void i(r+" is not valid url")}let d=new URL(window.location.href);if(l.hostname===d.hostname)return void i("can't short this url.");let a=new XMLHttpRequest;a.open("POST","api/shorten"),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onload=(()=>{let n=JSON.parse(a.responseText);if(200!==a.status)return void i(a.statusText);if(n.errcode)return void i(n.errmsg);const r=d.toString();o.value=("/"!==r.charAt(r.length-1)?r+"/":r)+n.data,e.style.display="block",t.style.display="none",o.addEventListener("change",s),o.addEventListener("input",s)}),a.send("url="+encodeURIComponent(l.toString()))}),e.addEventListener("click",t=>{if(t.preventDefault(),!navigator.clipboard)return void i("unable to copy");const{state:n}=navigator.permissions.query({name:"clipboard-write"});if("denied"===n)return void i("clipboard permission is denied.");let r;navigator.clipboard.writeText(o.value).then(()=>{e.classList.add("copied"),clearTimeout(r),r=setTimeout(()=>{e.classList.remove("copied")},1e3)}).catch(()=>{i("unable to copy")})})});